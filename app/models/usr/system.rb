class Usr::System < ActiveRecord::Base

  self.table_name = 'usr_systems'

  has_many :api_tokens, class_name: 'Api::Token'
  has_many :installed_software, class_name: 'Usr::InstalledSoftware'
  belongs_to :user, class_name: 'Usr::User'

  def current_api_key
    token = Api::Token.where("valid_until > ? AND system_id = ?", Time.now, self.id)

    if token.empty?
      u = Api::Token.create(system: self, token: Devise.friendly_token, valid_until: 2.days.from_now)
    else
      u = token.first # because token is a relation, which won't work if we want an object
    end

    return u.token
  end
end