require 'rails_helper'

RSpec.describe SystemsController, :type => :controller do

  before(:all) do
    FactoryGirl.create(:system)
  end

  describe "GET index" do
    it "assigns @systems" do
      system = System.all
      get :index
      expect(assigns(:systems)).to eq(system)
    end

    it "renders the index template" do
      get :index
      expect(response).to render_template("index")
    end

    it 'renders a json response if called' do
      get :index, format: :json
      body = JSON.parse(response.body)
      expect(body.class).to be(Hash)
      expect(body.key?('data')).to be_truthy
      expect(body['data'].count).to eq(1)
    end
  end

  describe "GET show" do
    it 'render the show template' do
      get :show, params: { id: System.first.id}
      expect(response.status).to eq(200)
      expect(response).to render_template("show")
    end
  end

  describe 'POST create' do
    it 'should show system after creating' do
      system = FactoryGirl.create(:system)
      expect(system.valid?).to be_truthy
      put :create, params: {:system => system.attributes }
      expect(response).to redirect_to :action => :show,
                                          :id => assigns(:system).id
    end
  end

  describe 'POST update' do
    it 'should show system after updating' do
      system = System.first
      system.name = 'Updated-System'
      expect(system.valid?).to be_truthy
      post :update, params: {:id => system.id, :system => system.attributes }
      expect(response).to redirect_to(system_path(system))
    end
  end

  describe 'DELETE destroy' do
    it 'should destroy a system' do
      system_count = System.all.count
      post 'destroy', params: {id: System.first.id}
      expect(response).to redirect_to(systems_path)
      expect(System.all.count).to eq(system_count -1)
    end
  end
end